// Global state management - ensure variables are on window object
window.cart = JSON.parse(localStorage.getItem('cart')) || [];
window.wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
window.user = JSON.parse(localStorage.getItem('user')) || null;
window.cartOpen = false;
window.mobileMenuOpen = false;
window.searchOpen = false;
window.userMenuOpen = false;

// Product data with streetwear focus and actual images
const products = {
    1: { id: 1, name: 'Oversized Graphic Tee', price: 1299, category: 'tshirts', image: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400&h=400&fit=crop', description: 'Premium cotton oversized streetwear tee', sizes: ['S', 'M', 'L', 'XL', 'XXL'] },
    2: { id: 2, name: 'Vintage Streetwear Tee', price: 1199, category: 'tshirts', image: 'https://images.unsplash.com/photo-1576566588028-4147f3842f27?w=400&h=400&fit=crop', description: 'Retro-inspired street style t-shirt', sizes: ['S', 'M', 'L', 'XL', 'XXL'] },
    3: { id: 3, name: 'Urban Logo Tee', price: 999, category: 'tshirts', image: 'https://images.unsplash.com/photo-1583743814966-8936f37f4678?w=400&h=400&fit=crop', description: 'Minimalist logo design streetwear', sizes: ['S', 'M', 'L', 'XL', 'XXL'] },
    4: { id: 4, name: 'Distressed Street Tee', price: 1399, category: 'tshirts', image: 'https://images.unsplash.com/photo-1562157873-818bc0726f68?w=400&h=400&fit=crop', description: 'Edgy distressed streetwear style', sizes: ['S', 'M', 'L', 'XL', 'XXL'] },
    5: { id: 5, name: 'Neon Graphic Tee', price: 1499, category: 'tshirts', image: 'https://images.unsplash.com/photo-1618354691373-d851c5c3a990?w=400&h=400&fit=crop', description: 'Bold neon streetwear design', sizes: ['S', 'M', 'L', 'XL', 'XXL'] },
    6: { id: 6, name: 'Classic Street Tee', price: 899, category: 'tshirts', image: 'https://images.unsplash.com/photo-1571945153237-4929e783af4a?w=400&h=400&fit=crop', description: 'Essential streetwear basic', sizes: ['S', 'M', 'L', 'XL', 'XXL'] }
};

// Initialize app
document.addEventListener('DOMContentLoaded', function() {
    updateCartCount();
    updateCartDisplay();
    initializeAnimations();
    initializeScrollEffects();
    initializeParallax();
    preloadImages();
    createSearchModal();
    createUserMenu();
    initializeKeyboardShortcuts();
});

// Enhanced Cart functionality with animations
function toggleCart() {
    const sidebar = document.getElementById('cartSidebar');
    const overlay = document.querySelector('.cart-overlay');
    const cartIcon = document.querySelector('.cart-icon');
    
    if (!sidebar || !overlay) return;
    
    window.cartOpen = !window.cartOpen;
    
    if (window.cartOpen) {
        closeAllModals();
        
        // Animate cart icon
        cartIcon.style.transform = 'scale(1.2) rotate(15deg)';
        cartIcon.style.color = 'var(--primary-red)';
        
        sidebar.classList.add('open');
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        // Staggered cart items animation
        setTimeout(() => {
            const cartItems = sidebar.querySelectorAll('.cart-item');
            cartItems.forEach((item, index) => {
                item.style.animation = `slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1) ${index * 0.1}s both`;
            });
        }, 150);
        
        // Cart sidebar entrance animation
        sidebar.style.animation = 'cartSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
        
    } else {
        // Reset cart icon
        cartIcon.style.transform = 'scale(1) rotate(0deg)';
        cartIcon.style.color = 'white';
        
        sidebar.style.animation = 'cartSlideOut 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
        
        setTimeout(() => {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        }, 400);
    }
}

function addToCart(productId = 1, name, price, size = 'M', quantity = 1) {
    const product = products[productId] || { id: productId, name: name || 'Product', price: price || 0 };
    
    const existingItem = window.cart.find(item => 
        item.id === productId && item.size === size
    );
    
    if (existingItem) {
        existingItem.quantity += quantity;
    } else {
        window.cart.push({
            id: productId,
            name: product.name,
            price: product.price,
            size: size,
            quantity: quantity,
            image: product.image
        });
    }
    
    localStorage.setItem('cart', JSON.stringify(window.cart));
    updateCartCount();
    updateCartDisplay();
    
    // Enhanced success feedback
    showNotification(`${product.name} added to cart!`, 'success');
    
    // Animate cart icon
    const cartIcon = document.querySelector('.cart-icon');
    cartIcon.style.animation = 'bounce 0.6s ease';
    setTimeout(() => {
        cartIcon.style.animation = '';
    }, 600);
}

function removeFromCart(productId, size) {
    const item = window.cart.find(item => item.id === productId && item.size === size);
    window.cart = window.cart.filter(item => !(item.id === productId && item.size === size));
    localStorage.setItem('cart', JSON.stringify(window.cart));
    updateCartCount();
    updateCartDisplay();
    showNotification(`${item ? item.name : 'Item'} removed from cart`, 'info');
}

function updateCartCount() {
    const count = cart.reduce((total, item) => total + item.quantity, 0);
    const cartCountElements = document.querySelectorAll('#cartCount');
    cartCountElements.forEach(element => {
        if (element) {
            element.textContent = count;
            if (count > 0) {
                element.style.display = 'flex';
            } else {\n                element.style.display = 'none';\n            }\n        }\n    });\n}\n\nfunction updateCartDisplay() {\n    const cartItems = document.getElementById('cartItems');\n    const cartTotal = document.getElementById('cartTotal');\n    \n    if (!cartItems || !cartTotal) return;\n    \n    if (cart.length === 0) {\n        cartItems.innerHTML = `\n            <div class=\"empty-cart\" style=\"text-align: center; padding: 3rem 0; color: #999;\">\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\" style=\"margin-bottom: 1rem; opacity: 0.5;\">\n                    <path d=\"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z\"></path>\n                    <line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"></line>\n                    <path d=\"m16 10a4 4 0 0 1-8 0\"></path>\n                </svg>\n                <p>Your cart is empty</p>\n                <p style=\"font-size: 0.9rem; margin-top: 0.5rem;\">Add some items to get started</p>\n            </div>\n        `;\n        cartTotal.textContent = '₹0';\n        return;\n    }\n    \n    let total = 0;\n    cartItems.innerHTML = cart.map((item, index) => {\n        total += item.price * item.quantity;\n        return `\n            <div class=\"cart-item\" style=\"display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 0; border-bottom: 1px solid #eee; animation-delay: ${index * 0.1}s;\">\n                <div style=\"flex: 1;\">\n                    <h4 style=\"margin-bottom: 0.5rem; font-size: 1rem;\">${item.name}</h4>\n                    <p style=\"color: #666; font-size: 0.9rem; margin-bottom: 0.5rem;\">Size: ${item.size}</p>\n                    <div style=\"display: flex; align-items: center; gap: 1rem;\">\n                        <div style=\"display: flex; align-items: center; border: 1px solid #ddd; border-radius: 4px;\">\n                            <button onclick=\"updateCartQuantity(${item.id}, '${item.size}', -1)\" style=\"background: none; border: none; padding: 0.25rem 0.5rem; cursor: pointer;\">-</button>\n                            <span style=\"padding: 0.25rem 0.5rem; min-width: 30px; text-align: center;\">${item.quantity}</span>\n                            <button onclick=\"updateCartQuantity(${item.id}, '${item.size}', 1)\" style=\"background: none; border: none; padding: 0.25rem 0.5rem; cursor: pointer;\">+</button>\n                        </div>\n                        <p style=\"color: var(--primary-red); font-weight: 600;\">$${item.price * item.quantity}</p>\n                    </div>\n                </div>\n                <button onclick=\"removeFromCart(${item.id}, '${item.size}')\" style=\"background: none; border: none; color: #999; cursor: pointer; font-size: 1.5rem; padding: 0.5rem; border-radius: 50%; transition: all 0.3s ease;\" onmouseover=\"this.style.background='#f5f5f5'; this.style.color='var(--primary-red)'\" onmouseout=\"this.style.background='none'; this.style.color='#999'\">&times;</button>\n            </div>\n        `;\n    }).join('');\n    \n    cartTotal.textContent = `₹${total}`;\n}\n\nfunction updateCartQuantity(productId, size, change) {\n    const item = cart.find(item => item.id === productId && item.size === size);\n    if (item) {\n        item.quantity += change;\n        if (item.quantity <= 0) {\n            removeFromCart(productId, size);\n        } else {\n            localStorage.setItem('cart', JSON.stringify(cart));\n            updateCartCount();\n            updateCartDisplay();\n        }\n    }\n}\n\n// Search functionality\nfunction createSearchModal() {\n    const searchModal = document.createElement('div');\n    searchModal.id = 'searchModal';\n    searchModal.innerHTML = `\n        <div class=\"search-overlay\" onclick=\"toggleSearch()\"></div>\n        <div class=\"search-container\">\n            <div class=\"search-header\">\n                <h3>Search Products</h3>\n                <button class=\"search-close\" onclick=\"toggleSearch()\">&times;</button>\n            </div>\n            <div class=\"search-input-container\">\n                <input type=\"text\" id=\"searchInput\" placeholder=\"Search for products...\" autocomplete=\"off\">\n                <button class=\"search-btn\" onclick=\"performSearch()\">\n                    <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                        <circle cx=\"11\" cy=\"11\" r=\"8\"></circle>\n                        <path d=\"m21 21-4.35-4.35\"></path>\n                    </svg>\n                </button>\n            </div>\n            <div class=\"search-results\" id=\"searchResults\">\n                <div class=\"search-suggestions\">\n                    <h4>Popular Searches</h4>\n                    <div class=\"suggestion-tags\">\n                        <span onclick=\"searchFor('jacket')\">Jackets</span>\n                        <span onclick=\"searchFor('dress')\">Dresses</span>\n                        <span onclick=\"searchFor('suit')\">Suits</span>\n                        <span onclick=\"searchFor('casual')\">Casual</span>\n                        <span onclick=\"searchFor('accessories')\">Accessories</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n    \n    // Add search modal styles\n    const searchStyles = `\n        #searchModal {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            z-index: 3000;\n            opacity: 0;\n            visibility: hidden;\n            transition: all 0.3s ease;\n        }\n        \n        #searchModal.open {\n            opacity: 1;\n            visibility: visible;\n        }\n        \n        .search-overlay {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.8);\n            backdrop-filter: blur(5px);\n        }\n        \n        .search-container {\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            background: white;\n            border-radius: 12px;\n            width: 90%;\n            max-width: 600px;\n            max-height: 80vh;\n            overflow: hidden;\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n        }\n        \n        .search-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 1.5rem;\n            border-bottom: 1px solid #eee;\n            background: var(--matte-black);\n            color: white;\n        }\n        \n        .search-header h3 {\n            font-family: 'Bebas Neue', cursive;\n            font-size: 1.5rem;\n            letter-spacing: 1px;\n            margin: 0;\n        }\n        \n        .search-close {\n            background: none;\n            border: none;\n            color: white;\n            font-size: 1.5rem;\n            cursor: pointer;\n            padding: 0.5rem;\n            border-radius: 50%;\n            transition: all 0.3s ease;\n        }\n        \n        .search-close:hover {\n            background: rgba(255, 255, 255, 0.1);\n            transform: rotate(90deg);\n        }\n        \n        .search-input-container {\n            display: flex;\n            padding: 1.5rem;\n            gap: 1rem;\n        }\n        \n        #searchInput {\n            flex: 1;\n            padding: 1rem;\n            border: 2px solid #ddd;\n            border-radius: 8px;\n            font-size: 1rem;\n            transition: border-color 0.3s ease;\n        }\n        \n        #searchInput:focus {\n            outline: none;\n            border-color: var(--primary-red);\n        }\n        \n        .search-btn {\n            padding: 1rem;\n            background: var(--primary-red);\n            color: white;\n            border: none;\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n        }\n        \n        .search-btn:hover {\n            background: #8B0000;\n            transform: scale(1.05);\n        }\n        \n        .search-results {\n            padding: 1.5rem;\n            max-height: 400px;\n            overflow-y: auto;\n        }\n        \n        .search-suggestions h4 {\n            margin-bottom: 1rem;\n            color: var(--matte-black);\n            font-family: 'Bebas Neue', cursive;\n            font-size: 1.2rem;\n            letter-spacing: 1px;\n        }\n        \n        .suggestion-tags {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 0.5rem;\n        }\n        \n        .suggestion-tags span {\n            padding: 0.5rem 1rem;\n            background: var(--light-gray);\n            border-radius: 20px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            font-size: 0.9rem;\n        }\n        \n        .suggestion-tags span:hover {\n            background: var(--primary-red);\n            color: white;\n            transform: translateY(-2px);\n        }\n        \n        .search-result-item {\n            display: flex;\n            align-items: center;\n            padding: 1rem;\n            border-bottom: 1px solid #eee;\n            cursor: pointer;\n            transition: all 0.3s ease;\n        }\n        \n        .search-result-item:hover {\n            background: var(--light-gray);\n            transform: translateX(5px);\n        }\n        \n        .search-result-image {\n            width: 60px;\n            height: 60px;\n            background: var(--gradient-primary);\n            border-radius: 8px;\n            margin-right: 1rem;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n            font-size: 0.8rem;\n        }\n        \n        .search-result-info h5 {\n            margin-bottom: 0.5rem;\n            color: var(--matte-black);\n        }\n        \n        .search-result-price {\n            color: var(--primary-red);\n            font-weight: 600;\n        }\n    `;\n    \n    const styleSheet = document.createElement('style');\n    styleSheet.textContent = searchStyles;\n    document.head.appendChild(styleSheet);\n    document.body.appendChild(searchModal);\n}\n\nfunction toggleSearch() {\n    const searchModal = document.getElementById('searchModal');\n    const searchInput = document.getElementById('searchInput');\n    \n    searchOpen = !searchOpen;\n    \n    if (searchOpen) {\n        closeAllModals();\n        searchModal.classList.add('open');\n        document.body.style.overflow = 'hidden';\n        setTimeout(() => {\n            searchInput.focus();\n        }, 300);\n    } else {\n        searchModal.classList.remove('open');\n        document.body.style.overflow = '';\n        searchInput.value = '';\n        document.getElementById('searchResults').innerHTML = `\n            <div class=\"search-suggestions\">\n                <h4>Popular Searches</h4>\n                <div class=\"suggestion-tags\">\n                    <span onclick=\"searchFor('jacket')\">Jackets</span>\n                    <span onclick=\"searchFor('dress')\">Dresses</span>\n                    <span onclick=\"searchFor('suit')\">Suits</span>\n                    <span onclick=\"searchFor('casual')\">Casual</span>\n                    <span onclick=\"searchFor('accessories')\">Accessories</span>\n                </div>\n            </div>\n        `;\n    }\n}\n\nfunction performSearch() {\n    const query = document.getElementById('searchInput').value.trim().toLowerCase();\n    if (!query) return;\n    \n    const results = Object.values(products).filter(product => \n        product.name.toLowerCase().includes(query) ||\n        product.category.toLowerCase().includes(query) ||\n        product.description.toLowerCase().includes(query)\n    );\n    \n    displaySearchResults(results, query);\n}\n\nfunction searchFor(term) {\n    document.getElementById('searchInput').value = term;\n    performSearch();\n}\n\nfunction displaySearchResults(results, query) {\n    const searchResults = document.getElementById('searchResults');\n    \n    if (results.length === 0) {\n        searchResults.innerHTML = `\n            <div style=\"text-align: center; padding: 2rem; color: #666;\">\n                <p>No results found for \"${query}\"</p>\n                <p style=\"font-size: 0.9rem; margin-top: 0.5rem;\">Try searching for jackets, dresses, or accessories</p>\n            </div>\n        `;\n        return;\n    }\n    \n    searchResults.innerHTML = `\n        <h4 style=\"margin-bottom: 1rem; color: var(--matte-black); font-family: 'Bebas Neue', cursive; font-size: 1.2rem; letter-spacing: 1px;\">\n            ${results.length} Result${results.length > 1 ? 's' : ''} for \"${query}\"\n        </h4>\n        ${results.map(product => `\n            <div class=\"search-result-item\" onclick=\"viewProductFromSearch(${product.id})\">\n                <div class=\"search-result-image\">${product.image}</div>\n                <div class=\"search-result-info\">\n                    <h5>${product.name}</h5>\n                    <p class=\"search-result-price\">$${product.price}</p>\n                </div>\n            </div>\n        `).join('')}\n    `;\n}\n\nfunction viewProductFromSearch(productId) {\n    toggleSearch();\n    setTimeout(() => {\n        viewProduct(productId);\n    }, 300);\n}\n\n// User menu functionality\nfunction createUserMenu() {\n    const userMenu = document.createElement('div');\n    userMenu.id = 'userMenu';\n    userMenu.className = 'user-dropdown';\n    userMenu.innerHTML = `\n        <div class=\"user-menu-content\">\n            ${user ? `\n                <div class=\"user-info\">\n                    <h4>Welcome, ${user.name}!</h4>\n                    <p>${user.email}</p>\n                </div>\n                <div class=\"user-menu-divider\"></div>\n                <a href=\"/account\" class=\"user-menu-item\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                        <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path>\n                        <circle cx=\"12\" cy=\"7\" r=\"4\"></circle>\n                    </svg>\n                    My Account\n                </a>\n                <a href=\"/orders\" class=\"user-menu-item\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                        <path d=\"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z\"></path>\n                        <line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"></line>\n                        <path d=\"m16 10a4 4 0 0 1-8 0\"></path>\n                    </svg>\n                    Order History\n                </a>\n                <a href=\"/wishlist\" class=\"user-menu-item\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                        <path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path>\n                    </svg>\n                    Wishlist (${wishlist.length})\n                </a>\n                <div class=\"user-menu-divider\"></div>\n                <button onclick=\"logout()\" class=\"user-menu-item logout-btn\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                        <path d=\"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\"></path>\n                        <polyline points=\"16,17 21,12 16,7\"></polyline>\n                        <line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\"></line>\n                    </svg>\n                    Sign Out\n                </button>\n            ` : `\n                <div class=\"user-auth\">\n                    <h4>Welcome to TRAGY</h4>\n                    <p>Sign in to access your account</p>\n                </div>\n                <div class=\"user-menu-divider\"></div>\n                <button onclick=\"showLogin()\" class=\"user-menu-item\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                        <path d=\"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4\"></path>\n                        <polyline points=\"10,17 15,12 10,7\"></polyline>\n                        <line x1=\"15\" y1=\"12\" x2=\"3\" y2=\"12\"></line>\n                    </svg>\n                    Sign In\n                </button>\n                <button onclick=\"showRegister()\" class=\"user-menu-item\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                        <path d=\"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"></path>\n                        <circle cx=\"8.5\" cy=\"7\" r=\"4\"></circle>\n                        <line x1=\"20\" y1=\"8\" x2=\"20\" y2=\"14\"></line>\n                        <line x1=\"23\" y1=\"11\" x2=\"17\" y2=\"11\"></line>\n                    </svg>\n                    Create Account\n                </button>\n            `}\n        </div>\n    `;\n    \n    // Add user menu styles\n    const userMenuStyles = `\n        .user-dropdown {\n            position: absolute;\n            top: 100%;\n            right: 0;\n            background: white;\n            border-radius: 8px;\n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n            min-width: 250px;\n            z-index: 2000;\n            opacity: 0;\n            visibility: hidden;\n            transform: translateY(-10px);\n            transition: all 0.3s ease;\n        }\n        \n        .user-dropdown.open {\n            opacity: 1;\n            visibility: visible;\n            transform: translateY(0);\n        }\n        \n        .user-menu-content {\n            padding: 1rem 0;\n        }\n        \n        .user-info {\n            padding: 0 1rem 1rem;\n        }\n        \n        .user-info h4 {\n            margin-bottom: 0.25rem;\n            color: var(--matte-black);\n            font-family: 'Bebas Neue', cursive;\n            font-size: 1.1rem;\n            letter-spacing: 1px;\n        }\n        \n        .user-info p {\n            color: #666;\n            font-size: 0.9rem;\n        }\n        \n        .user-auth {\n            padding: 0 1rem 1rem;\n            text-align: center;\n        }\n        \n        .user-auth h4 {\n            margin-bottom: 0.5rem;\n            color: var(--matte-black);\n            font-family: 'Bebas Neue', cursive;\n            font-size: 1.1rem;\n            letter-spacing: 1px;\n        }\n        \n        .user-auth p {\n            color: #666;\n            font-size: 0.9rem;\n        }\n        \n        .user-menu-divider {\n            height: 1px;\n            background: #eee;\n            margin: 0.5rem 0;\n        }\n        \n        .user-menu-item {\n            display: flex;\n            align-items: center;\n            gap: 0.75rem;\n            padding: 0.75rem 1rem;\n            color: var(--dark-gray);\n            text-decoration: none;\n            transition: all 0.3s ease;\n            border: none;\n            background: none;\n            width: 100%;\n            text-align: left;\n            cursor: pointer;\n            font-size: 0.9rem;\n        }\n        \n        .user-menu-item:hover {\n            background: var(--light-gray);\n            color: var(--primary-red);\n            transform: translateX(5px);\n        }\n        \n        .logout-btn:hover {\n            background: rgba(220, 53, 69, 0.1);\n            color: #dc3545;\n        }\n    `;\n    \n    const userStyleSheet = document.createElement('style');\n    userStyleSheet.textContent = userMenuStyles;\n    document.head.appendChild(userStyleSheet);\n    \n    // Position the menu relative to the user icon\n    const userIcon = document.querySelector('.user-icon');\n    userIcon.style.position = 'relative';\n    userIcon.appendChild(userMenu);\n}\n\nfunction toggleUserMenu() {\n    const userMenu = document.getElementById('userMenu');\n    userMenuOpen = !userMenuOpen;\n    \n    if (userMenuOpen) {\n        closeAllModals();\n        userMenu.classList.add('open');\n    } else {\n        userMenu.classList.remove('open');\n    }\n}\n\nfunction showLogin() {\n    toggleUserMenu();\n    showNotification('Login functionality coming soon!', 'info');\n    // Here you would typically show a login modal\n}\n\nfunction showRegister() {\n    toggleUserMenu();\n    showNotification('Registration functionality coming soon!', 'info');\n    // Here you would typically show a registration modal\n}\n\nfunction logout() {\n    user = null;\n    localStorage.removeItem('user');\n    toggleUserMenu();\n    showNotification('Signed out successfully', 'success');\n    // Recreate user menu to show logged out state\n    document.getElementById('userMenu').remove();\n    createUserMenu();\n}\n\n// Mobile menu functionality\nfunction toggleMobileMenu() {\n    const mobileMenu = document.getElementById('mobileMenu');\n    mobileMenuOpen = !mobileMenuOpen;\n    \n    if (mobileMenuOpen) {\n        closeAllModals();\n        mobileMenu.classList.add('open');\n        document.body.style.overflow = 'hidden';\n    } else {\n        mobileMenu.classList.remove('open');\n        document.body.style.overflow = '';\n    }\n}\n\n// Close all modals helper\nfunction closeAllModals() {\n    if (cartOpen) {\n        cartOpen = false;\n        document.getElementById('cartSidebar').classList.remove('open');\n        document.querySelector('.cart-overlay').classList.remove('active');\n    }\n    if (searchOpen) {\n        searchOpen = false;\n        document.getElementById('searchModal').classList.remove('open');\n    }\n    if (userMenuOpen) {\n        userMenuOpen = false;\n        document.getElementById('userMenu').classList.remove('open');\n    }\n    if (mobileMenuOpen) {\n        mobileMenuOpen = false;\n        document.getElementById('mobileMenu').classList.remove('open');\n    }\n    document.body.style.overflow = '';\n}\n\n// Wishlist functionality\nfunction toggleWishlist(productId) {\n    const product = products[productId];\n    if (!product) return;\n    \n    const existingIndex = wishlist.findIndex(item => item.id === productId);\n    \n    if (existingIndex > -1) {\n        wishlist.splice(existingIndex, 1);\n        showNotification(`${product.name} removed from wishlist`, 'info');\n    } else {\n        wishlist.push(product);\n        showNotification(`${product.name} added to wishlist!`, 'success');\n    }\n    \n    localStorage.setItem('wishlist', JSON.stringify(wishlist));\n    \n    // Update wishlist count in user menu if open\n    if (userMenuOpen) {\n        document.getElementById('userMenu').remove();\n        createUserMenu();\n        toggleUserMenu();\n    }\n}\n\n// Product navigation\nfunction viewProduct(productId) {\n    // Add loading animation\n    const productCard = event?.currentTarget;\n    if (productCard) {\n        productCard.style.transform = 'scale(0.95)';\n    }\n    \n    setTimeout(() => {\n        window.location.href = `/product/${productId}`;\n    }, 200);\n}\n\n// Enhanced notification system\nfunction showNotification(message, type = 'success') {\n    const notification = document.createElement('div');\n    notification.className = `notification ${type}`;\n    \n    const icons = {\n        success: '✓',\n        error: '✕',\n        info: 'ℹ',\n        warning: '⚠'\n    };\n    \n    const colors = {\n        success: 'var(--primary-red)',\n        error: '#dc3545',\n        info: '#17a2b8',\n        warning: '#ffc107'\n    };\n    \n    notification.style.cssText = `\n        position: fixed;\n        top: 100px;\n        right: 20px;\n        background: ${colors[type]};\n        color: white;\n        padding: 1rem 2rem;\n        border-radius: 8px;\n        z-index: 3000;\n        display: flex;\n        align-items: center;\n        gap: 0.5rem;\n        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);\n        backdrop-filter: blur(10px);\n        animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n        font-family: 'Poppins', sans-serif;\n        font-weight: 500;\n    `;\n    \n    notification.innerHTML = `\n        <span style=\"font-size: 1.2rem;\">${icons[type]}</span>\n        <span>${message}</span>\n    `;\n    \n    document.body.appendChild(notification);\n    \n    setTimeout(() => {\n        notification.classList.add('slide-out');\n        setTimeout(() => {\n            if (document.body.contains(notification)) {\n                document.body.removeChild(notification);\n            }\n        }, 400);\n    }, 3000);\n}\n\n// Advanced scroll effects\nfunction initializeScrollEffects() {\n    let lastScrollY = window.scrollY;\n    let ticking = false;\n    \n    function updateScrollEffects() {\n        const header = document.querySelector('.header');\n        const scrollY = window.scrollY;\n        \n        // Header hide/show\n        if (scrollY > lastScrollY && scrollY > 100) {\n            header.style.transform = 'translateY(-100%)';\n        } else {\n            header.style.transform = 'translateY(0)';\n        }\n        \n        // Header background opacity\n        if (scrollY > 50) {\n            header.classList.add('scrolled');\n        } else {\n            header.classList.remove('scrolled');\n        }\n        \n        lastScrollY = scrollY;\n        ticking = false;\n    }\n    \n    window.addEventListener('scroll', () => {\n        if (!ticking) {\n            requestAnimationFrame(updateScrollEffects);\n            ticking = true;\n        }\n    });\n}\n\n// Intersection Observer for animations\nfunction initializeAnimations() {\n    const observerOptions = {\n        threshold: 0.1,\n        rootMargin: '0px 0px -50px 0px'\n    };\n    \n    const observer = new IntersectionObserver((entries) => {\n        entries.forEach((entry, index) => {\n            if (entry.isIntersecting) {\n                setTimeout(() => {\n                    entry.target.classList.add('fade-in-up');\n                }, index * 100);\n            }\n        });\n    }, observerOptions);\n    \n    // Observe elements for animation\n    document.querySelectorAll('.product-card, .section, .footer-section').forEach(el => {\n        observer.observe(el);\n    });\n    \n    // Stagger animation for product grids\n    const productGrids = document.querySelectorAll('.product-grid');\n    productGrids.forEach(grid => {\n        const cards = grid.querySelectorAll('.product-card');\n        cards.forEach((card, index) => {\n            card.style.animationDelay = `${index * 0.1}s`;\n        });\n    });\n}\n\n// Parallax effects\nfunction initializeParallax() {\n    const parallaxElements = document.querySelectorAll('.parallax-section');\n    \n    if (parallaxElements.length === 0) return;\n    \n    function updateParallax() {\n        const scrollY = window.scrollY;\n        \n        parallaxElements.forEach(element => {\n            const rect = element.getBoundingClientRect();\n            const speed = element.dataset.speed || 0.5;\n            \n            if (rect.bottom >= 0 && rect.top <= window.innerHeight) {\n                const yPos = -(scrollY * speed);\n                element.style.transform = `translateY(${yPos}px)`;\n            }\n        });\n    }\n    \n    let ticking = false;\n    window.addEventListener('scroll', () => {\n        if (!ticking) {\n            requestAnimationFrame(updateParallax);\n            ticking = true;\n        }\n    });\n}\n\n// Image preloading\nfunction preloadImages() {\n    const imageUrls = [\n        'images/logo.png'\n        // Add more image URLs as needed\n    ];\n    \n    imageUrls.forEach(url => {\n        const img = new Image();\n        img.src = url;\n    });\n}\n\n// Keyboard shortcuts\nfunction initializeKeyboardShortcuts() {\n    document.addEventListener('keydown', function(e) {\n        // Escape key closes modals\n        if (e.key === 'Escape') {\n            closeAllModals();\n        }\n        \n        // Ctrl/Cmd + K opens search\n        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {\n            e.preventDefault();\n            toggleSearch();\n        }\n        \n        // Enter key on search input\n        if (e.key === 'Enter' && e.target.id === 'searchInput') {\n            performSearch();\n        }\n        \n        // Enter key on focusable elements\n        if (e.key === 'Enter' && e.target.classList.contains('product-card')) {\n            e.target.click();\n        }\n    });\n}\n\n// Touch gestures for mobile\nlet touchStartX = 0;\nlet touchEndX = 0;\n\ndocument.addEventListener('touchstart', function(e) {\n    touchStartX = e.changedTouches[0].screenX;\n});\n\ndocument.addEventListener('touchend', function(e) {\n    touchEndX = e.changedTouches[0].screenX;\n    handleSwipe();\n});\n\nfunction handleSwipe() {\n    const swipeThreshold = 50;\n    const diff = touchStartX - touchEndX;\n    \n    if (Math.abs(diff) > swipeThreshold) {\n        if (diff > 0 && cartOpen) {\n            // Swipe left to close cart\n            toggleCart();\n        } else if (diff < 0 && mobileMenuOpen) {\n            // Swipe right to close mobile menu\n            toggleMobileMenu();\n        }\n    }\n}\n\n// Click outside to close menus\ndocument.addEventListener('click', function(e) {\n    if (userMenuOpen && !e.target.closest('.user-icon')) {\n        toggleUserMenu();\n    }\n});\n\n// Performance optimization\nfunction debounce(func, wait) {\n    let timeout;\n    return function executedFunction(...args) {\n        const later = () => {\n            clearTimeout(timeout);\n            func(...args);\n        };\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n    };\n}\n\n// Window resize handler\nwindow.addEventListener('resize', debounce(() => {\n    // Recalculate animations and layouts\n    if (window.innerWidth > 768 && mobileMenuOpen) {\n        toggleMobileMenu();\n    }\n    \n    // Close user menu on mobile\n    if (window.innerWidth <= 768 && userMenuOpen) {\n        toggleUserMenu();\n    }\n}, 250));\n\n// Add CSS animations dynamically\nconst style = document.createElement('style');\nstyle.textContent = `\n    @keyframes bounce {\n        0%, 20%, 60%, 100% { transform: translateY(0); }\n        40% { transform: translateY(-10px); }\n        80% { transform: translateY(-5px); }\n    }\n    \n    @keyframes slideInRight {\n        from { transform: translateX(100%); opacity: 0; }\n        to { transform: translateX(0); opacity: 1; }\n    }\n    \n    @keyframes slideOutRight {\n        from { transform: translateX(0); opacity: 1; }\n        to { transform: translateX(100%); opacity: 0; }\n    }\n    \n    .cart-item {\n        transition: all 0.3s ease;\n    }\n    \n    .cart-item:hover {\n        background: rgba(176, 0, 32, 0.02);\n        transform: translateX(5px);\n    }\n    \n    .notification.slide-out {\n        animation: slideOutRight 0.4s ease;\n    }\n`;\ndocument.head.appendChild(style);\n\n// Export functions for global access\nwindow.addToCart = addToCart;\nwindow.toggleCart = toggleCart;\nwindow.toggleMobileMenu = toggleMobileMenu;\nwindow.toggleSearch = toggleSearch;\nwindow.toggleUserMenu = toggleUserMenu;\nwindow.viewProduct = viewProduct;\nwindow.toggleWishlist = toggleWishlist;\nwindow.performSearch = performSearch;\nwindow.searchFor = searchFor;\nwindow.viewProductFromSearch = viewProductFromSearch;\nwindow.showLogin = showLogin;\nwindow.showRegister = showRegister;\nwindow.logout = logout;\nwindow.updateCartQuantity = updateCartQuantity;